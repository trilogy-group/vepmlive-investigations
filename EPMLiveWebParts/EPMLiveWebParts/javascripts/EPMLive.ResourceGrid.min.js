function registerEpmLiveResourceGridScript(){(function(n,t,i,r,u){n.id=r.observable(null);n.autoFocus=!0;n.maxVScroll=null;n.webpartQualifier=null;n.pfeInstalled=!1;n.firstLoad=!0;n.epmrgv=null;n.resourceDictionary=null;n.resources=null;n.myResources=null;n.exportInProgress=!1;n.importInProgress=!1;n.webpartHeight=!1;n.userIsSiteAdmin=!1;n.allSelected=!1;n.reports={wcReportId:null,opened:!1,collection:{workvscapacity:{name:"Resource Work vs. Capacity",hasResourcesParam:!0,url:"{0}/_layouts/ReportServer/RSViewerPage.aspx?rv:RelativeReportUrl={1}/Report Library/Resource Work vs. Capacity.rdl&rp:SiteId={2}&rp:URL={1}&rv:HeaderArea=none".format(t.currentWebFullUrl,t.currentWebUrl,t.currentSiteId)}},getXmlForRibbon:function(){var t=new window.Sys.StringBuilder,u=!1,r,i,f;t.append("<Menu Id='Ribbon.ResourceGrid.Views.Dropdown.Menu'>");t.append("<MenuSection DisplayMode='Menu' Id='Ribbon.ResourceGrid.Reporting.ReportsDropDown.Menu' Title='Reports'>");t.append("<Controls Id='Ribbon.ResourceGrid.Reporting.ReportsDropDown.Menu.Controls'>");r=n.reports.collection;for(i in r)r.hasOwnProperty(i)&&i!=="workvscapacity"&&(u=!0,f=r[i],t.append("<Button Id='Ribbon.ResourceGrid.Reports.{0}' Command='ResourceGrid.Cmd.ReportsDropDown.Select' LabelText='{1}' CommandValueId='{0}'/>".format(i,f.name)));return u||t.append("<Button Id='Ribbon.ResourceGrid.Reports.{0}' Command='ResourceGrid.Cmd.ReportsDropDown.Select' LabelText='{1}' CommandValueId='{0}'/>".format("Loading","Loading...")),t.append("<\/Controls>"),t.append("<\/MenuSection>"),t.append("<\/Menu>"),t.toString()},open:function(t){var i,r;if(t&&t!=="0"&&t!==0&&t!=="Loading"){n.reports.opened=!0;var e=n.grid.grids[n.id()],u=e.GetSelRows(),f="";if(n.reports.collection[t].hasResourcesParam)for(i=0;i<u.length;i++)r=u[i],r.Kind==="Data"&&r.Def.Name==="R"&&(f+="&rp:Resources="+r.ResourceID);n.reports.opened=!0;window.open(n.reports.collection[t].url+f);window.setTimeout(function(){n.reports.opened=!1},2e3)}},load:function(){function r(i){var f,u,e,r,o,c,s,h,l;for(i.length||(i=[i]),f=0;f<i.length;f++)if(u=i[f],u["@Name"]==="epmlivetl"){for(u.Folder.length||(u.Folder=[u.Folder]),e=0;e<u.Folder.length;e++)if(r=u.Folder[e],r["@Name"]==="(2) Resource"||r["@Name"]==="Resources"){for(r.Folder&&r.Folder.length||(r.Folder=[r]),o=0;o<r.Folder.length;o++)for(c=r.Folder[o],s=0;s<c.Report.length;s++)h=c.Report[s],l=h["@Name"],n.reports.collection[t.md5(l)]={name:l,url:h["@Url"],hasResourcesParam:h["@HasResourcesParam"]==="True"};break}break}}i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'Reporting_GetAllReports', Dataxml: '<Reports/>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var u=t.parseJson(n.d),i=u.Result;t.responseIsSuccess(i)?i.GetAllReports.Data.Folder&&i.GetAllReports.Data.Folder.Folder&&r(i.GetAllReports.Data.Folder.Folder):t.logFailure(i)}else t.log("response.d: "+n.d)},error:function(n){t.log(n)}})}};n.grid={grids:window.Grids,filteringOn:!0,groupingOn:!0,showColumnSelector:function(){this.g().ActionShowColumns("Selectable")},hideRow:function(n){var t=this.g();t.HideRow(t.GetRowById(n))},showRow:function(n){var t=this.g();t.ShowRow(t.GetRowById(n))},hideFilters:function(){this.hideRow("Filter");this.filteringOn=!1},showFilters:function(){this.showRow("Filter");this.filteringOn=!0},hideGrouping:function(){var u=this.g(),n=null,t=u.Rows,i,r;for(i in t)if(t.hasOwnProperty(i)&&(r=t[i],r.Kind==="Group")){n=r.id;break}n&&(this.hideRow(n),this.groupingOn=!1)},showGrouping:function(){var u=this.g(),n=null,t=u.Rows,i,r;for(i in t)if(t.hasOwnProperty(i)&&(r=t[i],r.Kind==="Group")){n=r.id;break}n&&(this.showRow(n),this.groupingOn=!0)},toggleFiltering:function(){return this.filteringOn?this.hideFilters():this.showFilters(),window.setTimeout(function(){var t=n.grid.grids[n.id()];t.Update();t.Render()},10),this.filteringOn},toggleGrouping:function(){return this.groupingOn?this.hideGrouping():this.showGrouping(),window.setTimeout(function(){var t=n.grid.grids[n.id()];t.Update();t.Render()},10),this.groupingOn},removeSorting:function(){this.g().ChangeSort("Title");window.setTimeout(function(){var t=n.grid.grids[n.id()];t.Update();t.Render()},10)},resetNoDataRow:function(){var t=i("#"+n.id())[0],r,u,f;t&&(r=t.firstChild,this.g().GetFirstVisible()||(t.removeChild(r),u=t.insertRow(0),f=u.insertCell(0),f.innerHTML="No resource found."))},reload:function(){var t=window.location.href.replace(new RegExp("&epmrgv="+n.epmrgv,"gi"),"").replace(new RegExp("epmrgv="+n.epmrgv,"gi"),"");t=(t+(t.indexOf("?")!==-1?"&":"?")+"epmrgv="+n.views.currentView.id).replace(new RegExp("&&","g"),"&");window.location=t},rowsSelected:function(){try{return n.grid.grids[n.id()].GetSelRows().length}catch(t){return 0}},resourceUpdated:function(r,u,f){var o,h;if(r===1){var e=n.grid.grids[n.id()],c=f.row||{id:0},s=f.changeType;if(s==="Deleted"){e.AddDataFromServer("<Grid><Changes><I id='"+c.id+"' Deleted='1'/><\/Changes><\/Grid>");n.actions.reIndexResources();return}if(o=c.id,s==="Added"){o="";for(h in e.Rows)e.Rows.hasOwnProperty(h)&&(o+=e.Rows[h].id+",");o=o.slice(0,-1)}i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'GetResourcePoolDataGridChanges', Dataxml: '<ResourcePoolDataGridChanges><Params><ChangeType>"+s+"<\/ChangeType><Rows>"+o+"<\/Rows><\/Params><\/ResourcePoolDataGridChanges>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var r=t.parseJson(i.d);try{e.AddDataFromServer(r.ResourcePoolDataGridChanges.Data["#cdata"]);e.RenderBody();window.setTimeout(function(){var t=n.grid.grids[n.id()];t.Update();t.Render()},10);s==="Added"&&n.actions.reIndexResources()}catch(u){t.log(error)}}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}})}}};n.grid.g=r.dependentObservable(function(){return this.grids[n.id()]},n.grid);n.views={collection:{},totalViews:0,currentView:null,previousView:null,userHasGlobalViewModificationPermission:!1,build:function(t){var i=n.grid.g(),f,e,a,r,h;t.cols=[];t.filters=[];var v=i.Cols,u=i.GetCols("Visible"),y=0;for(f=0;f<u.length;f++)y+=i.Cols[u[f]].Width;for(e=0;e<u.length;e++){var c=u[e],o=i.Cols[c],s=o.Width,l=o.FixedWidth?o.FixedWidth===1?!0:!1:!1;l||(s=Math.round(s*100/y*1e3)/1e3);c==="Panel"&&(s=14,l=!0);t.cols.push({name:c,width:s,isfixedwidth:l,section:o.Sec})}t.filteringon=n.grid.filteringOn;a=i.GetRowById("Filter");for(r in v)v.hasOwnProperty(r)&&(h=a[r+"Filter"],h&&h!==0&&t.filters.push({column:r,value:a[r],cell:h}));return t.groupingon=n.grid.groupingOn,t.grouping=i.Group,t.sorting=i.Sort,t},getXml:function(n){for(var i='<View Id="{0}" Name="{1}" IsDefault="{2}" IsPersonal="{3}"><Cols>'.format(n.id,n.name,n.isdefault,n.ispersonal),t,u,f,r=0;r<n.cols.length;r++)t=n.cols[r],i+='<Col Name="{0}" Width="{1}" IsFixedWidth="{2}" Section="{3}"/>'.format(t.name,t.width,t.isfixedwidth,t.section);if(i+='<\/Cols><Filters RowVisible="{0}">'.format(n.filteringon||!1),n.filters)for(u=0;u<n.filters.length;u++)f=n.filters[u],i+='<Filter Column="{0}" Value="{1}" Cell="{2}"/>'.format(f.column,f.value,f.cell);return i+'<\/Filters><Grouping RowVisible="{0}">{1}<\/Grouping><Sorting>{2}<\/Sorting><\/View>'.format(n.groupingon||!1,n.grouping||"",n.sorting||"")},save:function(r){var u=n.grid.g();(u.StaticCursor=1,r.id=r.name!=="Default View"?t.md5(r.name):"dv",!this.collection[r.id]||confirm('Would you like to overwrite the "'+r.name+'" view?'))&&(r=this.build(r),i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'SaveResourcePoolViews', Dataxml: '<ResourceGridViews>"+this.getXml(r)+"<\/ResourceGridViews>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var u=t.parseJson(i.d);t.responseIsSuccess(u.Result)?(window.SP.UI.Notify.addNotification('The view "{0}" has been saved.'.format(r.name),!1),n.views.collection[r.id]=r,n.views.apply(r.id)):t.logFailure(u.Result)}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}}))},showSaveDialog:function(){var f=n.grid.g(),r=document.createElement("div"),u;r.innerHTML=i("#RWPSaveView-{0}".format(n.id())).html();i(i(r).find("#RWPSaveView-Name-{0}".format(n.id()))).val(this.currentView.name);this.currentView.isdefault&&i(i(r).find("#RWPSaveView-Default-{0}".format(n.id()))).attr("checked","checked");u=i(r).find("#RWPSaveView-Personal-{0}".format(n.id()));i(u).is(":disabled")||this.currentView.ispersonal&&i(u).attr("checked","checked");var e=i.browser.msie,o=e?140:135,s=e?230:225,t=window.SP.UI.$create_DialogOptions();t.title="Save View";t.html=r;t.height=o;t.width=s;t.allowMaximize=!1;t.showClose=!1;f.StaticCursor=0;f.ActionBlur();window.SP.UI.ModalDialog.showModalDialog(t)},apply:function(r){var f=null,l=t.getUrlParamByName("epmrgv"),it,rt,ct,o,u,lt,e,ut,a,p,w,ft,c,b,et,k,d,ot,st,ht,g,nt,tt;if(l&&n.firstLoad&&this.collection[l]&&(r=l,n.epmrgv=l),r)f=this.collection[r];else{it="dv";rt=null;for(ct in this.collection)o=this.collection[ct],o.ispersonal&&o.isdefault?rt=o.id:o.isdefault&&(it=o.id),f=this.collection[rt||it]}if(!this.currentView||this.currentView.id!==f.id){for(u=n.grid.g(),lt=n.actions.myResourcesOn,u.getColWidth||(u.getColWidth=function(n){if(n&&this.Cols[n]){var i=this.Cols[n].Width;return t.utils.isInt(i)||i.indexOf("-")!==-1&&(i=i.split("-")[0]),+i}return 0}),e=[],ut=[],a=0;a<f.cols.length;a++){var s=f.cols[a],h=s.name,v=u.Cols[h],y=0,at=u.getColWidth(h);s.isfixedwidth?(h==="Panel"&&(s.width=14),y=s.width-at):(y=-at,v&&(v.RelWidth=s.width));y!==0&&(v&&(v.Width+=y),u.Update());u.MoveCol(h,s.section,1,0);e.push(h)}for(u.Update(),u.Render(),p=u.Group.split(","),u.DoGrouping(null),w=0;w<p.length;w++)ft=p[w],ft&&u.HideCol(ft);for(c=u.GetCols("Visible"),c=c.concat(p),b=0;b<c.length;b++){for(et=!1,k=c[b],d=0;d<e.length;d++)if(e[d]===k){et=!0;break}!et&&k&&ut.push(k)}for(u.ChangeColsVisibility(e,ut,0),ot=[],st=[],ht=0;ht<e;ht++)ot.push(null),st.push(0);if(u.ChangeFilter(e,ot,st,0,0,null),g=f.filters,g){var vt=[],yt=[],pt=[];for(nt=0;nt<g.length;nt++)tt=g[nt],vt.push(tt.column),yt.push(tt.value),pt.push(tt.cell);u.ChangeFilter(vt,yt,pt,0,0,null)}else u.ChangeFilter("","","",0,0,null);f.filterrowvisible?n.grid.showFilters():n.grid.hideFilters();u.ChangeSort(f.sorting);n.grid.hideGrouping();u.DoGrouping(f.grouping||null);u.Update();u.Render();n.actions.myResourcesOn=!1;lt&&n.actions.toggleMyResources();this.currentView=f;window.RefreshCommandUI();n.firstLoad&&(n.actions.resetEasyScroll(),window.setTimeout(function(){n.firstLoad=!1},2e3));window.setTimeout(function(){var t=n.grid.g();t.Update();t.Render();i(".EPMLiveResourceGridGroup").click(function(n){var r,u,f,e;try{if(r=i(this).parent(),r&&(r=r[0],r)){u=r.attributes;for(f in u)u.hasOwnProperty(f)&&(e=u[f],e.name==="onmousemove"&&(r=t.Rows[e.value.split('"')[1]],r.Expanded===1?t.Collapse(r):t.Expand(r),n.stopPropagation()))}}catch(o){}})},10)}},load:function(){function r(t){function f(n){var t,i;return n&&(t=n.toLowerCase(),t==="true"?n=!0:t==="false"?n=!1:(i=parseInt(n),isNaN(i)||(n=i))),n}var e,r,o,s,u,i,b,h,c,k,l,a,d,g,v,y,nt,p,w,tt,it;for(t.length||(t=[t]),e=0;e<t.length;e++){r={};o=t[e];for(s in o)if(o.hasOwnProperty(s))if(u=s.replace(/@/,"").toLowerCase(),i=o[s],u==="cols"){for(i=i.Col,i.length||(i=[i]),b=[],h=0;h<i.length;h++){c=i[h];k={};for(l in c)c.hasOwnProperty(l)&&(k[l.replace(/@/,"").toLowerCase()]=f(c[l]));b.push(k)}r[u]=b}else if(u==="filters"){for(a in i)if(i.hasOwnProperty(a))if(d=a.replace(/@/,"").toLowerCase(),d==="filter"){for(i=i.Filter,i.length||(i=[i]),g=[],v=0;v<i.length;v++){y=i[v];nt={};for(p in y)y.hasOwnProperty(p)&&(nt[p.replace(/@/,"").toLowerCase()]=f(y[p]));g.push(nt)}r[u]=g}else r["filter"+d]=f(i[a])}else if(u==="grouping")for(w in i)i.hasOwnProperty(w)&&(tt=w.replace(/@/,"").toLowerCase(),it=f(i[w]),tt==="#text"?r[u]=it:r["grouping"+tt]=it);else r[u]=u!=="id"?f(i):i;n.views.collection[r.id]=r;n.views.totalViews++}}i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'GetResourcePoolViews', Dataxml: '<Views/>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var f=t.parseJson(i.d),u=f.Result;t.responseIsSuccess(u)?(n.views.totalViews=0,r(u.ResourcePoolViews.Views.View),n.views.apply()):t.logFailure(u)}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}})},getXmlForRibbon:function(){function r(i){var e,f,r;n.append("<MenuSection DisplayMode='Menu' Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.{0}' Title='{0} Views'>".format(i));n.append("<Controls Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.{0}.Controls'>".format(i));e=i==="Personal";for(f in t)if(t.hasOwnProperty(f)&&(r=t[f],r.name&&r.ispersonal===e)){if(r.id==="dv"&&u>1)continue;n.append("<Button Id='Ribbon.ResourceGrid.views.{0}' Command='ResourceGrid.Cmd.CurrentViewDropDown.Select' LabelText='{1}' CommandValueId='{0}'/>".format(r.id,r.name))}n.append("<\/Controls>");n.append("<\/MenuSection>")}var t=this.collection,i=this.currentView,u=this.totalViews,n=new window.Sys.StringBuilder;return n.append("<Menu Id='Ribbon.ResourceGrid.Views.Dropdown.Menu'>"),n.append("<MenuSection DisplayMode='Menu' Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.Default' Title='Current View'>"),n.append("<Controls Id='Ribbon.ResourceGrid.Views.Dropdown.Menu.Default.Controls'>"),n.append("<Button Id='Ribbon.ResourceGrid.views.{0}' Command='ResourceGrid.Cmd.CurrentViewDropDown.Select' LabelText='{1}' CommandValueId='{0}'/>".format(i.id,i.name)),n.append("<\/Controls>"),n.append("<\/MenuSection>"),r("Global"),r("Personal"),n.append("<\/Menu>"),n.toString()},remove:function(){var r=this.currentView;if(!this.userHasGlobalViewModificationPermission&&!r.ispersonal){alert("You are not allowed to delete a global view");return}if(r.id==="dv"){alert("You cannot delete the Default View");return}confirm('Are you sure you want to delete the "'+r.name+'" view?')&&i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'DeleteResourcePoolViews', Dataxml: '<ResourceGridViews>"+this.getXml(r)+"<\/ResourceGridViews>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var u=t.parseJson(i.d);t.responseIsSuccess(u.Result)?(window.SP.UI.Notify.addNotification('The view "{0}" has been deleted.'.format(r.name),!1),delete n.views.collection[r.id],n.views.totalViews--,n.views.apply()):t.logFailure(u.Result)}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}})},rename:function(r){if(r){var u=this.currentView,f=u.name;if(u.name=r,!this.userHasGlobalViewModificationPermission&&!u.ispersonal){alert("You are not allowed to rename a global view");return}if(u.id==="dv"){alert("You cannot rename the Default View");return}confirm('Are you sure you want to rename the "'+f+'" view?')&&i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'UpdateResourcePoolViews', Dataxml: '<ResourceGridViews>"+this.getXml(u)+"<\/ResourceGridViews>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var r=t.parseJson(i.d);t.responseIsSuccess(r.Result)?(window.SP.UI.Notify.addNotification('The view "{0}" has been renamed to "{1}".'.format(f,u.name),!1),n.views.currentView.name=u.name,n.views.collection[u.id].name=u.name,window.RefreshCommandUI()):t.logFailure(r.Result)}else t.log("response.d: "+i.d)},error:function(n){t.log(n)}})}},showRenameDialog:function(){var u=n.grid.g(),r=document.createElement("div");r.innerHTML=i("#RWPRenameView-{0}".format(n.id())).html();i(i(r).find("#RWPRenameView-CurrentName-{0}".format(n.id()))).html(this.currentView.name);var f=i.browser.msie,e=f?135:140,o=f?235:240,t=window.SP.UI.$create_DialogOptions();t.title="Rename View";t.html=r;t.height=e;t.width=o;t.allowMaximize=!1;t.showClose=!1;u.StaticCursor=0;u.ActionBlur();window.SP.UI.ModalDialog.showModalDialog(t)}};n.actions={easyScrollOn:!1,myResourcesOn:!1,loadRibbon:function(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){var t=function(n){window._ribbonStartInit(n,!0,null);i("#s4-ribbonrow").height(35);var t=window.setInterval(function(){document.getElementById("Ribbon.ResourceGridTab")||window.SelectRibbonTab(n,!0)},1);window.setTimeout(function(){window.clearInterval(t);try{var n=function(){var r=[i(document.getElementById("Ribbon.ResourceGridTab-title")),i(document.getElementById("Ribbon.ResourceGridViewTab-title"))],u,t;for(u in r)r.hasOwnProperty(u)&&(t=r[u],t.attr("style","border-top: 1px solid #E1E1E1 !important; height: 33px !important; margin-top: -4px !important"),t.find("a").attr("style","padding-top: 4px !important;"),t.attr("aria-selected")==="false"&&t.attr("style","height: 33px !important; margin-top: -3px !important"),t.click(function(){window.setTimeout(function(){n()},100)}))};n()}catch(r){}},2e3)},r=SP.Ribbon.PageManager.get_instance(),n=null;try{n=r.get_ribbon()}catch(u){}n||typeof window._ribbonStartInit=="function"&&t("Ribbon.ResourceGridTab")},"sp.ribbon.js")},dataTicketRequest:function(){var h=n.grid.g(),r=h.GetSelRows(),u,o,f,e,s;if(n.allSelected){r=[];u=h.Rows;for(o in u)u.hasOwnProperty(o)&&r.push(u[o])}for(f=[],e=0;e<r.length;e++)s=r[e],s.Def.Name==="R"&&f.push(s.EXTID);return f.length>0?i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/PortfolioEngine.asmx/Execute",data:"{ Function: 'GenerateDataTicket', Dataxml: '<GenerateDataTicket><Ticket>"+f.join(",")+"<\/Ticket><\/GenerateDataTicket>' }",contentType:"application/json; charset=utf-8",dataType:"json"}):null},retriveDataTicket:function(n){if(n.d){var i=t.parseJson(n.d),r=i.GenerateDataTicket;if(t.responseIsSuccess(r.Result))return r.Data.Ticket["@Id"];t.logFailure(i.Result)}else t.log("response.d: "+n.d);return null},displayPopUp:function(n,t,i,r,u,f,e,o){var h,s;i||(i=!0);r||(r=!0);u||(u=function(){});h=e&&o?{title:t,allowMaximize:i,showMaximized:!0,showClose:r,url:n,dialogReturnValueCallback:Function.createCallback(Function.createDelegate(null,u),f),width:e,height:o}:{title:t,allowMaximize:i,showClose:r,url:n,dialogReturnValueCallback:Function.createCallback(Function.createDelegate(null,u),f)};t==="Assignment Planner"&&(s=document.createElement("iframe"),s.setAttribute("src",n),s.setAttribute("width","99%"),s.setAttribute("height","98%"),h.url=null,h.html=s);window.SP.UI.ModalDialog.showModalDialog(h)},analyzeResources:function(){var i=n.actions.dataTicketRequest();i&&i.success(function(i){var r=n.actions.retriveDataTicket(i),u;r&&(u="{0}/_layouts/ppm/rpanalyzer.aspx?dataid={1}".format(t.currentWebUrl,r),n.actions.displayPopUp(u,"Resource Analyzer",!0,!0,null,null,700,700))})},redirect:function(i){var l=n.grid.grids[n.id()],o=l.GetSelRows(),s=o[0],u=null,h,f,e,c,r;if(n.grid.rowsSelected()>0&&(u=i==="viewprofile"?s.ResourceID:s.ID),i==="sendnotification"){for(h=[],f=0;f<o.length;f++)e=o[f],e.Kind==="Data"&&e.Def.Name==="R"&&(c=e.Email,c&&h.push(c));window.location.href="mailto:{0}".format(h.join(";"));return}r="{0}/_layouts/epmlive/redirectionproxy.aspx?listname=Resources&webid={1}".format(t.currentWebUrl,t.currentWebId);switch(i){case"add":n.actions.displayPopUp("{0}&action=new".format(r),null,!0,!0,n.grid.resourceUpdated,{row:null,changeType:"Added"});break;case"edit":n.actions.displayPopUp("{0}&action=edit&id={1}".format(r,u),null,!0,!0,n.grid.resourceUpdated,{row:s,changeType:"Changed"});break;case"showcomments":n.actions.displayPopUp("{0}&action={1}&id={2}".format(r,i,u),null,!0,!0,null,null,700,700);break;default:n.actions.displayPopUp("{0}&action={1}&id={2}".format(r,i,u))}},loadResourcePlanner:function(){var i=n.actions.dataTicketRequest();i&&i.success(function(i){var r=n.actions.retriveDataTicket(i),u;r&&(u="{0}/_layouts/ppm/RPEditor.aspx?dataid={1}&isresource=1".format(t.currentWebUrl,r),n.actions.displayPopUp(u,"Resource Planner",!0,!0,null,null,700,700))})},loadAssignmentPlanner:function(){for(var o=n.grid.g(),u=o.GetSelRows(),r=[],f,e,i=0;i<u.length;i++)f=u[i],r.push(f.ID);r.length>0&&(e="{0}/_layouts/epmlive/AssignmentPlanner.aspx?resources={1}&IsDlg=1".format(t.currentWebUrl,r.join(",")),n.actions.displayPopUp(e,"Assignment Planner",!0,!0,null,null,1e3,700))},deleteResource:function(){var u=n.grid.g(),r=u.GetSelRows()[0];if(r.Kind==="Data"&&r.Def.Name==="R"){if(!confirm("Are you sure you want to delete this resource?"))return;i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'DeleteResourcePoolResource', Dataxml: '<DeleteResourcePoolResource><Resource Id=\""+r.ID+"\"/><\/DeleteResourcePoolResource>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(u){var f,o,e,s;if(u.d)if(f=t.parseJson(u.d),t.responseIsSuccess(f.Result)){if(o=f.Result.DeleteResourcePoolResource.Resource,e=o["@Status"],e==="0")n.grid.resourceUpdated(1,null,{row:r,changeType:"Deleted"});else if(s=o["#cdata"],e==="1")alert(s);else if(e==="2"){if(!confirm(s))return;i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'DeleteResourcePoolResource', Dataxml: '<DeleteResourcePoolResource><Resource Id=\""+r.ID+'" ConfirmDelete="True"/><\/DeleteResourcePoolResource>\' }',contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i.d){var u=t.parseJson(i.d);t.responseIsSuccess(u.Result)?n.grid.resourceUpdated(1,null,{row:r,changeType:"Deleted"}):t.logFailure(u.Result)}else t.log("resp.d: "+i.d)},error:function(n){t.log(n)}})}}else t.logFailure(f.Result);else t.log("response.d: "+u.d)},error:function(n){t.log(n)}})}},resetEasyScroll:function(){var t=n.grid.g();i("#EPMLiveResourceGridSelector").watermark("Type here to search...");n.resourceDictionary==null&&n.actions.reIndexResources();i("#EPMLiveResourceGridSelector").autocomplete({source:function(t,r){var u=i.ui.autocomplete.filter(n.actions.myResourcesOn?n.myResources:n.resources,t.term);r(u)},select:function(i,r){var f=n.resourceDictionary[r.item.value],u;f&&(u=t.Rows[f],t.ExpandParents(u),t.ActionClearSelection(),t.SelectRow(u,!0),t.SetScrollTop(t.GetRowTop(u)));n.actions.toggleEasyScroll();window.setTimeout(function(){window.RefreshCommandUI()},100)}});i("#s4-ribbonrow").click(function(t){for(var f=!0,e=i(t.target).parents(),u,r=0;r<5;r++)try{if(u=e[r],u&&i(u)[0].id.indexOf("Ribbon.ResourceGrid.Actions.Find")!==-1){f=!1;break}}catch(o){}f&&n.actions.hideEasyScroll(!0)})},toggleEasyScroll:function(){var u=i(".callout"),t,r,f,e;if(u.length&&(u=u[0]),t=i(u),t.is(":visible"))n.actions.hideEasyScroll(!1);else{if(n.resources.length===0)return!1;r=document.getElementById("Ribbon.ResourceGrid.Actions.Find-Large");r||(r=document.getElementById("Ribbon.ResourceGrid.Actions.Find-Small"));r&&(f=i(r),e=f.offset(),t.css({top:e.top+f.height()}),t.css({left:e.left+f.width()/2-31}),i("#EPMLiveResourceGridSelector").val(""),t.show(),i("#EPMLiveResourceGridSelector").focus(),n.actions.easyScrollOn=!0)}return n.actions.easyScrollOn},reIndexResources:function(){var f=n.grid.g(),i,r,t,u;n.resourceDictionary={};n.resources=[];n.myResources=[];i=f.Rows;for(r in i)i.hasOwnProperty(r)&&(t=i[r],t.Kind==="Data"&&t.Def.Name==="R"&&(u=t.Title,n.resources.push(u),n.resourceDictionary[u]=r,t.IsMyResource===1&&n.myResources.push(u)))},toggleMyResources:function(){var t=n.grid.g();n.actions.myResourcesOn?(t.ChangeFilter("IsMyResource","0",6,0,1,null),n.actions.myResourcesOn=!1):(t.ChangeFilter("IsMyResource","1",1,0,1,null),n.actions.myResourcesOn=!0);window.setTimeout(function(){var t=n.grid.grids[n.id()];t.Update();t.Render()},500)},hideEasyScroll:function(t){var r=i(".callout"),u;r.length&&(r=r[0]);u=i(r);u.is(":visible")&&(u.hide(),n.actions.easyScrollOn=!1,t&&window.setTimeout(function(){window.RefreshCommandUI()},100))},exportResources:function(){var o,e,f,u,r;for(n.exportInProgress=!0,window.RefreshCommandUI(),o=i("#EPMLiveStatusbar").height(),e=t.ui.statusbar.collection(),f=0;f<e.length;f++)e[f].remove();u=t.ui.statusbar.add("Status","Exporting resources to Excel spreadsheet...");u.color("yellow");r=u.collection()[0];i.ajax({type:"POST",url:t.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: 'ExportResources', Dataxml: '<ExportResources/>' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){var s,f,e,o;i.d?(s=t.parseJson(i.d),f=s.Result,t.responseIsSuccess(f)?(e=f.ResourceExporter,e["@Success"]==="True"?(r.message('Resources exported succesfully. Click <a href="'+t.currentWebUrl+"/_layouts/epmlive/filedownloader.aspx?fileid="+e["@File"]+'&filename=Resources.xlsm&ct=application/ms-excel">here<\/a> to download the spreadsheet.'),u.color("blue")):(o=e["@Message"],t.log(o),r.title("Error"),r.message("Unable to export resources. The response was: "+o),u.color("red"))):(t.log(f),r.title("Error"),r.message("Unable to export resources. The response was: "+f),u.color("red"))):(t.log(i.d),r.title("Error"),r.message("Unable to export resources. There was no response from the server."),u.color("red"));n.exportInProgress=!1;window.RefreshCommandUI()},error:function(i){t.log(i);r.title("Error");r.message("Unable to export resources. The response was: ("+i.status+") "+i.statusText);u.color("red");n.exportInProgress=!1;window.RefreshCommandUI()}})},importResources:function(){var n=window.SP.UI.$create_DialogOptions();n.title="Import Resources";n.url=t.currentWebUrl+"/_layouts/epmlive/importresources.aspx";n.dialogReturnValueCallback=window.epmLiveResourceGrid.actions.onImportResourcesCompleted;window.SP.UI.ModalDialog.showModalDialog(n)},onImportResourcesCompleted:function(t){t===1&&n.grid.reload()},canExport:function(){return!n.exportInProgress&&n.userIsSiteAdmin},canImport:function(){return!n.importInProgress&&n.userIsSiteAdmin}};window.Grids.OnClick=function(t,i,r,u,f,e){var s,c,h,o;if(n.actions.loadRibbon(),n.actions.hideEasyScroll(!0),i.Kind==="Data"&&i.Def.Name==="R"){if(e.shiftKey&&e.ctrlKey||!e.shiftKey&&!e.ctrlKey?(c=i.Selected,r!=="Panel"&&t.ActionClearSelection(),s=t.SelectRow(i,!c)):e.shiftKey?(h=t.GetSelRows(),t.ActionClearSelection(),s=h?t.SelectRange(h[0],null,i,null,1,1):t.SelectRow(i,!i.Selected)):s=t.SelectRow(i,!i.Selected),s!==null)return window.RefreshCommandUI(),!0}else if(i.Def.Name==="Group"){if(r==="Panel"){for(t.SelectRow(i,!i.Selected),o=i.firstChild;o;)t.SelectRow(o,i.Selected),o=o.nextSibling;return window.RefreshCommandUI(),!0}}else i.Kind==="Header"&&r==="Panel"&&(n.allSelected=!n.allSelected,window.setTimeout(function(){window.RefreshCommandUI()},100))};window.Grids.OnExpand=function(n){i.browser.msie&&window.setTimeout(function(){n.Render();n.Update();n.Render();window.setTimeout(function(){n.Render();n.Update();n.Render();n.Render();n.SetScrollTop(n.GetScrollTop()+2);n.SetScrollTop(n.GetScrollTop()-2)},200)},200)};window.Grids.OnColumnsChanged=function(n,t){var f=n.GetLastCol("1"),r,i;for(r in t)t[r]&&n.MoveCol(r,f,!0,0);if(i=t.ProfilePic,!i&&!t.length)try{i=t.ProfilePic}catch(e){}i!==u&&(n.SetAttribute(null,"ProfilePic","Visible","0",0),n.Rerender())};window.Grids.OnReady=function(t){n.id(t.id);n.views.load();n.reports.load()};window.Grids.OnUpdated=function(){n.grid.resetNoDataRow()};window.Grids.OnLoaded=function(r){var o=i.browser.msie?20:5,f=n.webpartHeight,u=f,e;f||(u=i("#s4-workspace").height()-(i("#s4-titlerow").height()+i("#EPMLiveStatusbar").height()+i("#EPMLiveStatusbarTemplate").height()+i("#EPMLiveStatuTemplate").height()+i("#s4-statusbarcontainer").height()+o)-100);r.MaxVScroll=u;f||(i("#MSOZoneCell_WebPart"+n.webpartQualifier).height(u),i("#WebPart"+n.webpartQualifier).height(u));n.loader?(t.utils.fireEvent(document.getElementById("MSOZoneCell_WebPart"+n.webpartQualifier),"mouseup"),n.loader.close()):i("#ResourceGridLoader").hide();e=i(window);n.winHeight=e.height();e.resize(function(){var t=i(this).height(),u=n.winHeight,f;f=t<u?-(u-t):t-u;f!==0&&(r.MaxVScroll+=f,n.winHeight=t,r.Update())});r.Update();r.Render();window.setTimeout(function(){n.actions.loadRibbon()},1500)};window.Grids.OnGetHtmlValue=function(n,t,i,r){if(t.Def.Name==="Group"){if(i!=="Panel"&&i!=="Title")return""}else if(n.Cols[i]&&n.Cols[i].Type==="Lines")return r};window.Grids.OnGetColor=function(n,t,r,u,f,e){if(r==="Title"&&(u===230||u===180||u===255)&&(f===242||f===217||f===255)&&(e===251||e===243||e===255)&&t.r0){var o=i(t.r0).find(".GSCellPanel");o&&(u===230&&f===242&&e===251?i(o).addClass("EPMLiveResourceGridPanelHovered"):u===180&&f===217&&e===243?i(o).addClass("EPMLiveResourceGridPanelHoveredSelected"):i(o).removeClass("EPMLiveResourceGridPanelHovered EPMLiveResourceGridPanelHoveredSelected"))}return null};window.SP.SOD.notifyScriptLoadedAndExecuteWaitingJobs("EPMLive.ResourceGrid.js")})(window.epmLiveResourceGrid=window.epmLiveResourceGrid||{},window.epmLive,window.jQuery,window.ko)}ExecuteOrDelayUntilScriptLoaded(registerEpmLiveResourceGridScript,"EPMLive.js");window.console||(console={});console.error=console.error||function(){};console.log=console.log||function(){};
//# sourceMappingURL=EPMLive.ResourceGrid.min.js.map