(function(){"use strict";function n(){$(function(){var n=window.jQuery,t=function(){var t=function(t,i,r,u){var f=window.epmLive;n.ajax({type:"POST",url:f.currentWebUrl+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: '"+t+"', Dataxml: '"+i+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var i=f.parseJson(n.d),t=i.Result;f.responseIsSuccess(t)?r(t):u(n)}else u(n)},error:function(n){u(n)}})};return{execute:t}}(),i=function(){function d(){for(var t,n=0;n<r.length;n++)if(t=r[n],t.selected()){t.closeNav();break}}function a(t){var f=["s4-ribbonrow","s4-workspace"],e,r,u;for(e in f)r=n("#"+f[e]),r.removeClass("epm-nav-pinned"),r.removeClass("epm-nav-unpinned"),r.addClass("epm-nav-"+t);u=n("#epm-nav-pin");u.removeClass("epm-nav-pin-pinned");u.removeClass("epm-nav-pin-unpinned");u.addClass("epm-nav-pin-"+t);t==="unpinned"&&d();i.data("pinstate",t);n.cookie(l,t,s)}function ut(){i.data("pinstate")==="pinned"?a("unpinned"):a("pinned")}function g(){return(n.cookie(b)||"epm-nav-top-ql").replace("epm-nav-top-","epm-nav-sub-")}function h(t){return n("#"+t).find(".epm-nav-sub-menu").find("div[id^=E]")}function ft(){var u=n.parseJSON(n.cookie(k)),i,r,e,o,t;if(u&&(i=u.index,r=u.uri,window.location.href.indexOf(r)!==-1))if(e=n("#"+g()),i&&i!==-1){for(o=h(e.parent().attr("id")),t=0;t<o.length;t++)if(t===i){n(o[t]).find('a[href="'+r+'"]:first').parents("table").addClass(f);break}}else e.find('a[href="'+r+'"]:first').parents("table").addClass(f)}function et(t){var i={};t.find(".epm-nav-cat").each(function(){var t=n(this);i[t.text()]=n(t.find("span")[0]).hasClass(u)});nt(t.get(0).id,i)}function nt(t,i){var r=n.parseJSON(n.cookie(o))||{};r[t]=i;n.cookie(o,JSON.stringify(r),s)}function tt(t){var w=n.parseJSON(n.cookie(o)),i,f,c,e,l,s,a,y,p;if(w){if(i=g(),t)for(f=0;f<r.length;f++)if(c=r[f],c.provider===t){i=c.id.replace("epm-nav-top-","epm-nav-sub-");break}if(e=w[i],e)if(i==="epm-nav-sub-ql")for(l=h("epm-nav-sub-ql"),s=0;s<l.length;s++)a=l[s],y=a.id.replace("Nodes",""),e[n("#"+y.replace("EPMLiveNavn","EPMLiveNavt")).text()]&&TreeView_ToggleNode(window.EPMLiveNav_Data,0,document.getElementById(y)," ",document.getElementById(a.id));else p=n("#"+i).find(".epm-nav-cat"),i==="epm-nav-sub-settings"&&p.each(function(){v(n(this))}),p.each(function(){var t=n(this),r=t.text(),i=e[r];n(t.find("span")[0]).hasClass(u)?i||v(t):i&&it(t)})}}function it(t){var f=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+f+"-links");i.removeClass(e);i.addClass(u);r.removeClass(e);r.addClass(u)}function v(t){var f=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+f+"-links");i.removeClass(u);i.addClass(e);r.removeClass(u);r.addClass(e)}function ot(){n(".epm-nav-cat").click(function(){var t=n(this),i=n(t.find("span")[0]);i.hasClass(e)?it(t):v(t);et(t.parent())})}function st(){var c=window.TreeView_HoverNode,l=window.TreeView_UnhoverNode,a=window.TreeView_ToggleNode,u,f,r,t,e;window.TreeView_HoverNode=function(t,i){var r=n(i);r.hasClass(p)?r.parent().parent().parent().addClass(w):c(t,i)};window.TreeView_UnhoverNode=function(t){var i=n(t);i.hasClass(p)?n(t).parent().parent().parent().removeClass(w):l(t)};window.TreeView_ToggleNode=function(t,i,r,u,f){var w=null,e=n.parseJSON(n.cookie(o)),s,v,d,y,c;e&&(e=n.parseJSON(n.cookie(o))["epm-nav-sub-ql"],e&&(w=e));var b=w||{},l=null,k=n(r).parents("div");for(s=0;s<k.length;s++)if(v=k[s],d=n(v),d.hasClass("epm-nav-sub")){for(l=v.id,y=h(l),c=0;c<y.length;c++){var g=y[c],p=n(g).is(":visible"),tt=g.id.replace("Nodes","");tt===r.id&&(p=!p);b[n("#"+tt.replace("EPMLiveNavn","EPMLiveNavt")).text()]=p}break}nt(l,b);a(t,i,r,u,f)};u=["suiteBar","s4-ribbonrow","s4-workspace"];for(f in u)n("#"+u[f]).click(function(){i.data("pinstate")==="unpinned"&&d()});r=n("#epm-nav-pin");r.click(function(){ut()});i.hover(function(){r.show()},function(){r.hide()});i.slimScroll({height:i.height(),width:i.width()});t=n("#epm-nav").find(".slimScrollDiv");e=t.find(".slimScrollBar");t.css("position","absolute");t.css("left","50px");i.css("left","0");e.css("z-index",1001);n(window).resize(function(){var r=n("#epm-nav-top").height();t.height(r);i.height(r)});n("a.epm-nav-node").click(function(){var r=-1,u=n(this),f=u.parents("div")[0],e=n(f).siblings("div"),i,t,o;if(e)for(i=h(n(e[0]).parent().parent().attr("id")),t=0;t<i.length;t++)o=i[t],o.id===f.id&&(r=t);n.cookie(k,JSON.stringify({index:r,uri:u.attr("href")}),s)})}function ht(){for(var i=[],u,f,n=0;n<r.length;n++)u=r[n],u.selected()||(f=u.provider,f&&i.push(f));i.length>0&&t.execute("GetNavigationLinks",i.join(),function(n){var o=epmLive.currentWebUrl,h=o+window.location.href.split(o)[1],i,f,s,t,u,e;for(i in n.Nodes){f=n.Nodes[i].NavLink;for(s in f)for(t=f[s],u=0;u<r.length;u++)e=r[u],e.provider===i&&e.registerLink({id:t["@Id"],title:t["@Title"],url:t["#cdata"].replace(/{page}/g,h),category:t["@Category"],cssClass:t["@CssClass"],order:parseInt(t["@Order"]),external:t["@Exernal"]==="True",visible:t["@Visible"]==="True",seprator:t["@Separator"]==="True"});tt(i)}ot()},function(n){console.log(n)})}var y=300,p="epm-nav-node",w="epm-nav-node-hover",c="epm-nav-node-opened",f="epm-nav-node-selected",u="epm-nav-node-expanded",e="epm-nav-node-collapsed",b="epmnav-selected-tlnode",k="epmnav-selected-link",o="epmnav-expand-state",l="epmnav-pin-state",s={expires:365,path:"/"},i=n("#epm-nav-sub"),r=[],rt=function(t){var o={},a=t,u=n(t),e=n("#epm-nav-sub-"+u.data("id")),h=a.id,nt=u.data("linkprovider"),v=function(){return u.parent().hasClass(f)},tt=function(){return u.parent().hasClass(c)},p=function(n){n?u.parent().addClass(f):u.parent().removeClass(f)},w=function(){e.hide();u.parent().removeClass(c)},k=function(){i.is(":visible")&&i.hide("slide",{direction:"left"},y);w()},it=function(n){n.seprator?ut(n.category):(ft(n.category),rt(n))},rt=function(t){var i=t.category,r;i||(i="__STATIC__");r='<li id="'+t.id+'" class="epm-nav-node" style="display:none;"><a id="epm-nav-link-'+t.id+'" href="'+t.url+'" alt="'+t.title+'">'+t.title+"<\/a><\/li>";o[i].$el.append(r);t.external&&n("#epm-nav-link-"+t.id).attr("target","_blank");t.visible&&n("#"+t.id).show()},ut=function(t){var i='<div class="epm-nav-sub-sep"><\/div>';t?n("#"+d(t)).append(i):e.append(i)},ft=function(t){if(t||(t="__STATIC__"),!o[t]){var i=d(t),r="epm-nav-node-expanded";t==="__STATIC__"&&(r="epm-nav-node-static");t!=="__STATIC__"&&e.append('<div id="'+i+'" class="epm-nav-node epm-nav-node-root epm-nav-cat"><span class="'+r+'">&nbsp;<\/span><span class="epm-nav-cat-title" alt="'+t+'">'+t+"<\/span><\/div>");e.append('<ul id="'+i+'-links" class="epm-nav-links '+r+'"><\/ul>');o[t]={id:i,$el:n("#"+i+"-links")}}},d=function(n){return e.get(0).id+"-"+n.toLowerCase().replace(/ /g,"-").replace(/_/g,"").replace(/[^\w-]+/g,"").replace(/--/g,"-")},et=function(){e.show();u.parent().addClass(c)},g=function(){et();i.is(":visible")||i.show("slide",{direction:"left"},y)};return u.click(function(){var i,t;if(v())tt()&&n.cookie(l)==="unpinned"?k():g();else{for(i in r)t=r[i],t.id!==h&&t.selected()&&(t.select(!1),t.close());p(!0);g();n.cookie(b,h,s)}}),{id:h,provider:nt,selected:v,select:p,close:w,closeNav:k,registerLink:it,el:a,$el:u,$menu:e}},ct=function(){var t=n.cookie(l);n("#epm-nav-top").find("[data-role='top-nav-node']").each(function(){r.push(new rt(this))});a(t||"pinned");tt();ft();st();ExecuteOrDelayUntilScriptLoaded(ht,"EPMLive.js")};return{init:ct}}();i.init()})}function t(){ExecuteOrDelayUntilScriptLoaded(n,"EPMLiveNavigation")}ExecuteOrDelayUntilScriptLoaded(t,"jquery.min.js")})();
//@ sourceMappingURL=EPMLive.Navigation.min.js.map