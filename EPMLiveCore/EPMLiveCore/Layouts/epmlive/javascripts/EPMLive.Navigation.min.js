(function(){"use strict";function n(){$(function(){var n=window.jQuery,t=function(){var t=function(){return window.epmLiveNavigation.currentWebUrl},i=function(xml){return eval("("+window.xml2json(n.parseXML(xml),"")+")")},r=function(n){return n["@Status"]==0};return{currentWebUrl:t,parseJson:i,responseIsSuccess:r}}(),u=function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(t){var i="",o,s,h="",c,f,r,e="",u=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&console.log('There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, "+", "/",and "="\nExpect errors in decoding.');t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c=n.indexOf(t.charAt(u++)),f=n.indexOf(t.charAt(u++)),r=n.indexOf(t.charAt(u++)),e=n.indexOf(t.charAt(u++)),o=c<<2|f>>4,s=(f&15)<<4|r>>2,h=(r&3)<<6|e,i=i+String.fromCharCode(o),r!=64&&(i=i+String.fromCharCode(s)),e!=64&&(i=i+String.fromCharCode(h)),o=s=h="",c=f=r=e="";while(u<t.length);return unescape(i)};return{decode:t}}(),i=function(){var i=function(r,u,f,e){var o=t.currentWebUrl();o?n.ajax({type:"POST",url:o+"/_vti_bin/WorkEngine.asmx/Execute",data:"{ Function: '"+r+"', Dataxml: '"+u+"' }",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){if(n.d){var r=t.parseJson(n.d),i=r.Result;t.responseIsSuccess(i)?f(i):e(n)}else e(n)},error:function(n){e(n)}}):window.setTimeout(function(){i(r,u,f,e)},1)};return{execute:i}}(),r=function(){function tt(){for(var t,n=0;n<f.length;n++)if(t=f[n],t.selected()){t.closeNav();break}}function p(t){var f=["s4-ribbonrow","s4-workspace"],e,i,u;for(e in f)i=n("#"+f[e]),i.removeClass("epm-nav-pinned"),i.removeClass("epm-nav-unpinned"),i.addClass("epm-nav-"+t);u=n("#epm-nav-pin");u.removeClass("epm-nav-pin-pinned");u.removeClass("epm-nav-pin-unpinned");u.addClass("epm-nav-pin-"+t);t==="unpinned"&&tt();r.data("pinstate",t);n.cookie(y,t,c)}function ot(){r.data("pinstate")==="pinned"?p("unpinned"):p("pinned")}function st(){return(n.cookie(nt)||"epm-nav-top-ql").replace("epm-nav-top-","epm-nav-sub-")}function l(t){return n("#"+t).find(".epm-nav-sub-menu").find("div[id^=E]")}function ht(){var u=n.parseJSON(n.cookie(v)),i,r,f,e,t;if(u&&(i=u.index,r=u.uri,window.location.href.indexOf(r)!==-1))if(f=n("#"+st()),i&&i!==-1){for(e=l(f.parent().attr("id")),t=0;t<e.length;t++)if(t===i){n(e[t]).find('a[href="'+r+'"]:first').parents("table").addClass(o);break}}else f.find('a[href="'+r+'"]:first').parents("table").addClass(o)}function ct(t){var i={};t.find(".epm-nav-cat").each(function(){var t=n(this);i[t.text()]=n(t.find("span")[0]).hasClass(e)});it(t.get(0).id,i)}function it(t,i){var r=n.parseJSON(n.cookie(h))||{};r[t]=i;n.cookie(h,JSON.stringify(r),c)}function w(t){var p=n.parseJSON(n.cookie(h)),i,r,s,u,c,o,a,v,y;if(p){if(i="epm-nav-sub-ql",t)for(r=0;r<f.length;r++)if(s=f[r],s.provider===t){i=s.id.replace("epm-nav-top-","epm-nav-sub-");break}if(u=p[i],u)if(i==="epm-nav-sub-ql")for(c=l("epm-nav-sub-ql"),o=0;o<c.length;o++)a=c[o],v=a.id.replace("Nodes",""),u[n("#"+v.replace("EPMLiveNavn","EPMLiveNavt")).text()]||TreeView_ToggleNode(window.EPMLiveNav_Data,0,document.getElementById(v)," ",document.getElementById(a.id));else y=n("#"+i).find(".epm-nav-cat"),i==="epm-nav-sub-settings"&&y.each(function(){b(n(this))}),y.each(function(){var t=n(this),r=t.text(),i=u[r];n(t.find("span")[0]).hasClass(e)?i||b(t):i&&rt(t)})}}function rt(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(s);i.addClass(e);r.removeClass(s);r.addClass(e)}function b(t){var u=t.get(0).id,i=n(t.find("span")[0]),r=n("#"+u+"-links");i.removeClass(e);i.addClass(s);r.removeClass(e);r.addClass(s)}function lt(){n(".epm-nav-cat").click(function(){var t=n(this),i=n(t.find("span")[0]);i.hasClass(s)?rt(t):b(t);ct(t.parent())})}function at(){var o=window.TreeView_HoverNode,s=window.TreeView_UnhoverNode,a=window.TreeView_ToggleNode,u,f,i,t,e;window.TreeView_HoverNode=function(t,i){var r=n(i);r.hasClass(d)?r.parent().parent().parent().addClass(g):o(t,i)};window.TreeView_UnhoverNode=function(t){var i=n(t);i.hasClass(d)?n(t).parent().parent().parent().removeClass(g):s(t)};window.TreeView_ToggleNode=function(t,i,r,u,f){var w=null,e=n.parseJSON(n.cookie(h)),o,v,d,y,s;e&&(e=n.parseJSON(n.cookie(h))["epm-nav-sub-ql"],e&&(w=e));var b=w||{},c=null,k=n(r).parents("div");for(o=0;o<k.length;o++)if(v=k[o],d=n(v),d.hasClass("epm-nav-sub")){for(c=v.id,y=l(c),s=0;s<y.length;s++){var g=y[s],p=n(g).is(":visible"),nt=g.id.replace("Nodes","");nt===r.id&&(p=!p);b[n("#"+nt.replace("EPMLiveNavn","EPMLiveNavt")).text()]=p}break}it(c,b);a(t,i,r,u,f)};u=["suiteBar","s4-ribbonrow","s4-workspace"];for(f in u)n("#"+u[f]).click(function(){r.data("pinstate")==="unpinned"&&tt()});i=n("#epm-nav-pin");i.click(function(){ot()});r.hover(function(){i.show()},function(){i.hide()});r.slimScroll({height:r.height(),width:r.width()});t=n("#epm-nav").find(".slimScrollDiv");e=t.find(".slimScrollBar");t.css("position","absolute");t.css("left","50px");r.css("left","0");e.css("z-index",1001);n(window).resize(function(){var i=n("#epm-nav-top").height();t.height(i);r.height(i)});n("a.epm-nav-node").click(function(){var r=-1,u=n(this),f=u.parents("div")[0],e=n(f).siblings("div"),i,t,o;if(e)for(i=l(n(e[0]).parent().parent().attr("id")),t=0;t<i.length;t++)o=i[t],o.id===f.id&&(r=t);n.cookie(v,JSON.stringify({index:r,uri:u.attr("href")}),c)})}function ut(n){var s=t.currentWebUrl(),c=s+window.location.href.split(s)[1],r,u,h,i,e,o;for(r in n.Nodes){u=n.Nodes[r].NavLink;u.length||(u=[u]);for(h in u)for(i=u[h],e=0;e<f.length;e++)o=f[e],o.provider===r&&o.registerLink({id:i["@Id"],title:i["@Title"],url:(i["#cdata"]||"").replace(/{page}/g,c),category:i["@Category"],cssClass:i["@CssClass"],order:parseInt(i["@Order"]),siteId:i["@SiteId"],webId:i["@WebId"],listId:i["@ListId"],itemId:i["@ItemId"],external:i["@Exernal"]==="True",visible:i["@Visible"]==="True",seprator:i["@Separator"]==="True"});window.SP.SOD.notifyScriptLoadedAndExecuteWaitingJobs("EPMLiveNavigation_"+r);r!=="Settings"&&w(r)}}function vt(){for(var t=[],r,u,n=0;n<f.length;n++)r=f[n],r.selected()||(u=r.provider,u&&t.push(u));t.length>0&&i.execute("GetNavigationLinks",t.join(),function(n){ut(n);lt()},function(n){console.log(n)})}function ft(){var n=null;window.epmLiveNavigation&&(n=window.epmLiveNavigation.staticProvider);n?ut(t.parseJson(u.decode(n))):window.setTimeout(function(){ft()},1)}function yt(){n("#epm-nav-top").find("[data-role='top-nav-node']").each(function(){f.push(new et(this))})}var k=300,d="epm-nav-node",g="epm-nav-node-hover",a="epm-nav-node-opened",o="epm-nav-node-selected",e="epm-nav-node-expanded",s="epm-nav-node-collapsed",nt="epmnav-selected-tlnode",v="epmnav-selected-link",h="epmnav-expand-state",y="epmnav-pin-state",c={expires:365,path:"/"},r=n("#epm-nav-sub"),f=[],et=function(t){var e={},h=t,i=n(t),u=n("#epm-nav-sub-"+i.data("id")),s=h.id,it=i.data("linkprovider"),l=function(){return i.parent().hasClass(o)},rt=function(){return i.parent().hasClass(a)},p=function(n){n?i.parent().addClass(o):i.parent().removeClass(o)},w=function(){u.hide();i.parent().removeClass(a)},b=function(){r.is(":visible")&&r.hide("slide",{direction:"left"},k);w()},ut=function(n){n.seprator?ot(n.category):n.url.toLowerCase()==="header"?(d(n.category),ft(n)):(d(n.category),et(n))},ft=function(n){var t=n.category,i;t||(t="__STATIC__");i='<li class="epm-nav-sub-header">'+n.title+"<\/li>";e[t].$el.append(i);i='<li class="epm-nav-sub-header-bottom"><\/li>';e[t].$el.append(i)},et=function(t){var i=t.category,r,u;i||(i="__STATIC__");r="";t.cssClass&&(r='<span class="epm-nav-icon '+t.cssClass+'"><\/span>');u='<li id="'+t.id+'" class="epm-nav-node" style="display:none;">'+r+'<a id="epm-nav-link-'+t.id+'" href="'+t.url+'" alt="'+t.title+'" data-siteid="'+t.siteId+'" data-webid="'+t.webId+'" data-listid="'+t.listId+'" data-itemid="'+t.itemId+'"><span>'+t.title+"<\/span><\/a><\/li>";e[i].$el.append(u);t.external&&n("#epm-nav-link-"+t.id).attr("target","_blank");t.visible&&n("#"+t.id).show();n(e[i].$el.find("a").get(0)).click(function(){var t=n(this);t.parent().addClass("epm-nav-node-selected");n.cookie(v,JSON.stringify({id:t.get(0).id,url:t.attr("href")}),c)})},ot=function(t){var i='<div class="epm-nav-sub-sep"><\/div>';t?n("#"+g(t)).append(i):u.append(i)},d=function(t){if(t||(t="__STATIC__"),!e[t]){var i=g(t),r="epm-nav-node-expanded";t==="__STATIC__"&&(r="epm-nav-node-static");t!=="__STATIC__"&&u.append('<div id="'+i+'" class="epm-nav-node epm-nav-node-root epm-nav-cat"><span class="'+r+'">&nbsp;<\/span><span class="epm-nav-cat-title" alt="'+t+'">'+t+"<\/span><\/div>");u.append('<ul id="'+i+'-links" class="epm-nav-links '+r+'"><\/ul>');e[t]={id:i,$el:n("#"+i+"-links")}}},g=function(n){return u.get(0).id+"-"+n.toLowerCase().replace(/ /g,"-").replace(/_/g,"").replace(/[^\w-]+/g,"").replace(/--/g,"-")},st=function(){u.fadeIn(300);i.parent().addClass(a)},tt=function(){st();r.is(":visible")||r.show("slide",{direction:"left"},k)};return i.click(function(){var i,t;if(l())rt()&&n.cookie(y)==="unpinned"?b():tt();else{for(i in f)t=f[i],t.id!==s&&t.selected()&&(t.select(!1),t.close());p(!0);tt();n.cookie(nt,s,c)}}),{id:s,provider:it,selected:l,select:p,close:w,closeNav:b,registerLink:ut,el:h,$el:i,$menu:u}},pt=function(){yt();ft();p(n.cookie(y)||"pinned");w();ht();at();ExecuteOrDelayUntilScriptLoaded(vt,"EPMLive.js")};return{init:pt,expandProviderNodes:w}}();r.init();var f=function(){var t=function(){var t=function(t){t.find(".epm-nav-cat").each(function(){var t=n(n(this).find("span").get(0));t.removeClass("epm-nav-node-expanded");t.addClass("epm-nav-node-collapsed")});t.find(".epm-nav-links").each(function(){var t=n(this);t.hasClass("epm-nav-node-static")||(t.removeClass("epm-nav-node-expanded"),t.addClass("epm-nav-node-collapsed"))})};return{collapseAll:t}}(),i=n("#epm-nav-sub-settings");t.collapseAll(i);r.expandProviderNodes("Settings")},e=function(){var r=function(){var t=function(t){var r=[],u=0;t.find(".epm-nav-node").each(function(){r.push(n(this).get(0).id+":"+ ++u)});r.length&&i.execute("ReorderFavorites",r.join(),function(){},function(n){console.log(n)})},r=function(t){t.prepend('<span class="epm-nav-dragger">&nbsp;<\/span>');t.hover(function(){n(n(this).find(".epm-nav-dragger").get(0)).css("visibility","visible")},function(){n(n(this).find(".epm-nav-dragger").get(0)).css("visibility","hidden")})},u=function(n){n.append('<span class="epm-menu-btn"><span class="icon-ellipsis-horizontal"><\/span><\/span>')};return{resetOrder:t,addDragger:r,addMenu:u}}(),t=n("#epm-nav-sub-favorites-static-links");t.find(".epm-nav-node").each(function(){var t=n(this);r.addDragger(t);r.addMenu(t)});t.sortable({placeholder:"epm-nav-drag-placeholder",update:function(){r.resetOrder(t)}});t.disableSelection()},o=function(){var r=function(){var n=function(n,r){n.index()<r?t(n):i(n)},t=function(n){n.append('<span class="epm-menu-btn"><span class="icon-plus-2"><\/span><\/span>')},i=function(n){n.append('<span class="epm-menu-btn"><span class="icon-ellipsis-horizontal"><\/span><\/span>')};return{addMenu:n}}(),t=n("#epm-nav-sub-recent-static-links"),i;t.find(".epm-nav-sub-header").each(function(){var t=n(this),r=t.text(),u=t.index();r==="Recent Items"&&(i=u)});t.find(".epm-nav-node").each(function(){r.addMenu(n(this),i)})};ExecuteOrDelayUntilScriptLoaded(f,"EPMLiveNavigation_Settings");ExecuteOrDelayUntilScriptLoaded(e,"EPMLiveNavigation_Favorites");ExecuteOrDelayUntilScriptLoaded(o,"EPMLiveNavigation_RecentItems")})}function t(){ExecuteOrDelayUntilScriptLoaded(n,"EPMLiveNavigation")}ExecuteOrDelayUntilScriptLoaded(t,"jquery.min.js")})();
//@ sourceMappingURL=EPMLive.Navigation.min.js.map